<!doctype html>
<html lang="en" ng-app="doraApp">
<head>
  <meta charset="utf-8">
  <title>Dora - Iteration 2.5</title>
  <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.css">
  <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
  <link rel="stylesheet" type="text/css" href="/static/ol2/style.css">
  <link rel="stylesheet" type="text/css" href="/static/css/stylesheet.css">
  <link rel="stylesheet" href="/static/jquery-ui/jquery-ui.custom.css">
  <link rel="stylesheet" href="/static/angular-modules/slider/css/classic.css">
  <link rel="stylesheet" href="/static/angular-modules/allmighty-autocomplete/autocomplete.css">
  
  <script src="/static/angular/angular.js"></script>
  <script src="/static/jquery/jquery.js"></script>
  <script src="/static/ol2/ol.js"></script>
  <script type="text/javascript" src ="/static/ol2/custom-regpolyhandler.js"></script>
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>

  <script src="/static/js/app.js"></script>
  <script src="/static/js/controllers.js"></script>
  <script src="/static/js/services.js"></script>
  <script src="/static/js/directives.js"></script>
  <script src="/static/js/qrspanel.js"></script>

  <script src="/static/jquery-ui/jquery-ui.custom.js"></script>
  <script src="/static/angular-modules/slider/jQDateRangeSlider-min.js"></script>
  <script type="text/javascript" src="/static/angular-modules/allmighty-autocomplete/autocomplete.js"></script>
  <!-- <link rel="css/iThing.css" type="text/css" /> -->

</head>
{% verbatim %}
<body>
  <div id="map">
    <div id="customZoom">
      <a href="#customZoomIn" id="customZoomIn">+</a>
      <a href="#customZoomOut" id="customZoomOut">-</a>
    </div>
  </div>

  <div class="queryForm" ng-controller="QueryFormController">
   <div class="above input-group" id="searchbox">
    <form ng-submit="submitFilter()">
     <div class="form-control autocom-input">
      <span ng-bind="key" id="key"></span>
      <autocomplete ng-model="input" on-select="selectFilter" 
      attr-input-class="removeInputStyle"
      data="data" attr-placeholder="Add a search criteria"
      attr-class="autocom-div"></autocomplete>
     </div>
     <span class="input-group-btn">
      <button type="submit" class="btn btn-info" ng-disabled="!key || !input">
       <span class="glyphicon glyphicon-plus"></span>
      </button>
     </span>
    </form>
   </div>

   <div class="location-options">
    <button type="button" class="btn btn-primary" ng-click="toggleButton()">{{buttonName()}}</button>
    <button ng-show="locationSearchOn" type="button" class="btn btn-danger" ng-click="clearShapes()">Clear shapes</button>
    <div class="location-radio" ng-show="locationSearchOn">
     <input type="radio" ng-model="mapServMode" name="mapDrawControls" value="drawing" ng-change="changeMode(mapServMode)" checked>Add Polygon<br>
     <input type="radio" ng-model="mapServMode" name="mapDrawControls" value="regular" ng-change="changeMode(mapServMode)">Add Circle<br>
     <input type="radio" ng-model="mapServMode" name="mapDrawControls" value="modifying" ng-change="changeMode(mapServMode)">Modify Shapes
    </div>
   </div>
  
  <div class="filters noselect">
  	<button type="button" class="btn btn-primary submitButton" ng-click="submitQuery()" ng-show="filters.length > 0">Submit</button>
  	<span class="filter" ng-repeat="filter in filters">
  		<span ng-click="editFilter($index, filter)">&nbsp;{{filter}}&nbsp;&nbsp;</span>
  		<span ng-click="removeFilter($index)" class="bold hover-text-shadow">&#215;&nbsp;</span>
  	</span>
  </div>
 </div>


<div ng-controller="QueryResultController">

  <div class="above" id="qrsbuttons">
    <div class="nowrap" ng-repeat="qrs in QRSHistory"  ng-mouseleave="hover=false">
      
      <span ng-show="hover" ng-click="removeQRS($index)" class="glyphicon glyphicon-remove inline" ng-style="($index === 0 && {'margin-top': '7px'})||($index === 1 && {'margin-top': '41px'})||($index === 2 && {'margin-top': '75px'})||($index === 3 && {'margin-top': '109px'})||($index === 4 && {'margin-top': '143px'})||($index === 5 && {'margin-top': '177px'})||($index === 6 && {'margin-top': '211px'})" id="cross"></span>

      <button type="button" class="btn btn-success btn-circle btn-color-{{qrs.color.buttonStyleIndex}} inline bottom-margin" ng-class="visibility($index)" ng-click="setDisplayedQRS($index);selectQRS($index);" ng-dblclick="toggleQRSVisibility($index);" ng-mouseenter="hover=true"></button>

    </div>
    <img src="/static/loading.gif" ng-show="loadingStatus.isLoading"/>
  </div>

  <div class="above" id="qrspanel">  
    <!-- ng-show="{{QRSHistory}}"-->
    <div class="panel panel-info">
      <div class="panel-heading">
        <h3 class="panel-title" ng-click="panelVisible=!panelVisible" id="qrs-panel-title"> qrs {{displayedQRS.assigned[0].disease}} </h3>
        <button ng-click="setQRSClustering(true)">Cluster On</button>
        <button ng-click="setQRSClustering(false)">Cluster Off</button>
        <button type="submit" ng-click="exportQRS()" id="export-btn">
          <img src="/static/images/export.png" width="20" height="20" alt="submit"/>
        </button>
      </div>

      <div ng-show="panelVisible" class="panel-body" id="qrs-panel-body">  
        <!-- {{displayedQRS}} -->
        <div>
          <a ng-click="chartOneVisible=!chartOneVisible">Patient Number</a>
          <div ng-show="chartOneVisible" id="line-chart"></div>
        </div>

        <div>
          <a ng-click="chartTwoVisible=!chartTwoVisible">Patient Distribution Along Age Groups</a>
          <div ng-show="chartTwoVisible" id="chart_div"></div>
        </div>

        <a ng-click="encounterVisible=!encounterVisible">Show all encounters</a> 
        <br/>

        <div ng-show="encounterVisible">
          Filter: <input  type="text" class="form-control" ng-model="search.$"> <br>
        </div>
<!--           By patient name: <input ng-model="search.patient"><br>
          By Procedure: <input ng-model="search.procedure"><br>
          By observer: <input ng-model="search.observer"><br> -->
          <div class="list-group" ng-show="encounterVisible" style="width:100%;">
            <div id="encounter" ng-repeat="encounter in encounters| filter:search:strict">
              <a href="#" class="list-group-item">{{encounter.patient}}<br/>
                <div style="font-size:medium;white-space: nowrap; width: 100%;  overflow: hidden; text-overflow:ellipsis;">{{encounter.procedure}}</div>
                <div style="text-align: right;">by {{encounter.observer}} on {{encounter.date}}</div>
              </a>
            </div>
          </div> 
        </div>
      </div>
    </div>
    <br/>

    <div id="union-intersection">
      <div class="btn-group above inline">
        <button type="button" class="btn btn-default btn-union-intersect" ng-click="selectionFunction = 'union'; selectionFlag = true;">Union</button>
        <button type="button" class="btn btn-default btn-union-intersect" ng-click="selectionFunction = 'intersect'; selectionFlag = true;">Intersect</button>
      </div>

      <div class="inline">
        <button ng-repeat="qrs in selectedQRSList" type="button" class="btn btn-success btn-circle btn-color-{{QRSHistory[selectedQRSList[$index]].color.buttonStyleIndex}} side-margin above">{{selectedQRSList[$index]}}</button>
      </div> 

      <button type="button" class="btn btn-primary above" ng-show="selectionFlag" ng-click="executeUnionIntersection()">Apply</button>
      <button type="button" class="btn btn-danger above" ng-show="selectionFlag" ng-click="resetUnionIntersectVariables()">Cancel</button>
    </div>

  </div>


  <div ng-controller="TemporalSliderController" class="above" id="slider-div"> 
    <div id="slider"></div>
    <button type="submit" class="above" id="slider_btn">
      <img src="/static/images/play.png" width="30" height="24" alt="submit" />
    </button>
  </div>

  {% endverbatim %}
  <!-- scripts loaded after html-->

</body>

</html>
