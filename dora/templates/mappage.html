<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">
	<head>
	    <style>
	    	.map {
				position: absolute;
				top: 0px;
				left: 0px;
			    height: 100%;
			    width: 100%;
	    	}
	    </style>
    	<script src="http://openlayers.org/en/v3.0.0/build/ol.js" type="text/javascript"></script>
    	<title>Dora</title>
	</head>
	<body>
    	<div id="map" class="map"></div>
    	<script type="text/javascript">
			var count = 2000;
			var features = new Array(count);
			for (var i = 0; i < count; ++i) {
				var coordinates = (ol.proj.transform([Math.random() * (103.969836 - 103.669836) + 103.669836, Math.random() * (1.452083 - 1.252083) + 1.252083], 'EPSG:4326', 'EPSG:3857'));
				//var coordinates = [Math.random() * (10000000 - 10000000) + 11000000, Math.random() * (1 - 1) + 1];
				features[i] = new ol.Feature(new ol.geom.Point(coordinates));
			}

			var source = new ol.source.Vector({
				features: features
			});

			var clusterSource = new ol.source.Cluster({
				distance: 50,
				source: source
			});

			var styleCache = {};
			var clusters = new ol.layer.Vector({
				source: clusterSource,
				style: function(feature, resolution) {
			    	var size = feature.get('features').length;
			    	var style = styleCache[size];
			    	var radiusAdjusted = 10*Math.pow(size, 0.2);
			    	if (radiusAdjusted > 21) { radiusAdjusted = 21; }
		    		if (!style) {
		    			style = [new ol.style.Style({
			        		image: new ol.style.Circle({
				        		radius: radiusAdjusted,
				        		stroke: new ol.style.Stroke({
					        		color: '#fff'
					        	}),
					        	fill: new ol.style.Fill({
					            	color: '#3399CC'
					        	})
			        		}),
			        		text: new ol.style.Text({
		          				text: size.toString(),
		          				fill: new ol.style.Fill({
		            				color: '#fff'
		          				})
		        			})
		      			})];
		      		styleCache[size] = style;
			    	}
			    	return style;
				}
			});

			var raster = new ol.layer.Tile({
				source: new ol.source.MapQuest({layer: 'osm'})
			});

			var raw = new ol.layer.Vector({
				source: source
			});

			var map = new ol.Map({
				layers: [raster, clusters],
				renderer: 'canvas',
				target: 'map',
				view: new ol.View({
				    center: ol.proj.transform([103.819836, 1.352083], 'EPSG:4326', 'EPSG:3857'),
				    zoom: 12
				})
			});
    	</script>
  	</body>
</html>

